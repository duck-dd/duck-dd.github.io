<!DOCTYPE html>
<html><head>
<title>DNS,挺好,啥是DNS?</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="DNS,挺好,啥是DNS?" />
<meta property="og:description" content="DNS，挺好，啥是DNS？ 一些概念  FQDN: Fully Qualified Domain Name，全限定域名，同时带有主机名和域名的名称（通过符号“.”），例如一个FQDN是www.baidu.com，www是主机名，baidu.com是域名。再举例，我是海淀吴彦祖，你是**吴彦祖，但是我们还知道，有个人就叫吴彦祖，这么多吴彦祖我们都没有混淆，因为名字前面加上了地域，也就是域名。从逻辑上看FQDN，就是主机名的完整表达，类似绝对路径，通过一个FQDN我们可以在全网内锁定主机位置。 cache only DNS server : 有.的zone file的DNS服务器，本身没有任何解析数据，完全靠查询来获取数据源 forwarding DNS server : 连.的zone file都没有，完全靠向上层查询获取数据；当使用forwarding功能时，即使本身有.的zone file，也不会向.查询，该DNS server还是会将查询完全委托给上层。 CIDR:Classless Inter-Domain Routing, 无类域间路由，不按固定的字节来划分网络编号，可以使用IP地址中任何相邻位的数字作为网络编号，例如某机构需要2个B类网络大小的空间，那么可以使用前15位作为网络编号，例如127.127.0.0/15  A类,B类,C类网络：A类网络以IP地址的第一个字节(前8位)作为网络编号,剩下的24位为主机;B类网络前两个字节为网络编号;C类网络前三个字节为网络编号    DNS做什么 ipv4 32bit，ipv6 128bit，即使转成10/16进制也没人记得住，但是人类的头脑善于记录名字，所以可以搞一个名字跟IP对应，名字跟IP的对应关系解析，就是DNS提供的服务。
主机名的解析有一个发展的过程。
最初没有DNS人们如何记住各个服务名字跟IP的对应关系呢？就是写在/etc/hosts文件里，自己写麻烦，那就统一写到中心，使用的时候从中心拉取。
这个中心就是internic，主机名IP对应关系修改时，注册到internic中；用户准备上网之前先去internic把最新的文件拉下来，放在自己的/etc/hosts。
这种方式问题很多：
 例如internic拉取的文件会很大，每次打开电脑先拉个100G的文件然后再开始上网，就算你磁盘扛得住，你的网络不够好也很难受（因为你不能明确说明自己上网需要的主机名，只能拉全量，互联网业务增长该文件会越来越大） 例如这种方式是静态的，需要用户主动触发更新行为（你总不能让一个人开机默认就去下载100G的文件，他不可能给你授权的）；试想一下，一个网瘾少年下午6点睡眼惺忪的起床，打开电脑先从internic下载了半个小时文件，期间去洗漱吃了早饭，然后开开心心开始打游戏，突然，游戏掉线了，上贴吧一查，大家都说快去重新拉取internic的hosts文件呀，游戏域名被友商攻击换域名了，这还好，少年骂骂咧咧下载个文件就完事了，要是贴吧都上不去就更让人懵逼了  时代的进步总是聪明人推动的。Berkeley一个同学就觉得这种方式不太行，于是他就搞出一套BIND系统提供DNS服务。
BIND，Berkeley Internet Name Domain BIND管理方式 BIND是一套阶层式的管理主机名与IP对应关系的系统。
阶层式？可以简单理解为树状结构的不同层级，下面来简单分析下阶层式。
以www.baidu.com为例，最上层根服务器，domain name是&quot;.&quot;，然后有三个hostname &ldquo;net com cn&rdquo;，再到第三层，hostname分别是pdd baidu tencent，此时domain name为.com. ，以此类推。。。需要注意的是，不是每一个&quot;.&ldquo;都拆分domain name&amp;hostname，例如上图 video.www.baidu.com ，其中domain name为baidu.com.，hostname为video.www。按照上述方式分层，每一个服务节点（权威）只负责自己的一小撮域名，这就避免了大量数据集中的问题。
DNS阶层系统的最上方是一个&rdquo;.&quot;，root，是根服务器，本质上讲，这里的&quot;.&ldquo;后面其实是空标签，这是为root保留的；根服务器下一层管理的是Top Level Domains(TLD)，例如com. net. org.等等。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tianqizhang93.github.io/posts/cs/dns/dns-bind/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-13T20:53:32+08:00" />
<meta property="article:modified_time" content="2021-05-13T20:53:32+08:00" /><meta property="og:site_name" content="ZTQ&#39;s Blog" />






<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="DNS,挺好,啥是DNS?"/>
<meta name="twitter:description" content="DNS，挺好，啥是DNS？ 一些概念  FQDN: Fully Qualified Domain Name，全限定域名，同时带有主机名和域名的名称（通过符号“.”），例如一个FQDN是www.baidu.com，www是主机名，baidu.com是域名。再举例，我是海淀吴彦祖，你是**吴彦祖，但是我们还知道，有个人就叫吴彦祖，这么多吴彦祖我们都没有混淆，因为名字前面加上了地域，也就是域名。从逻辑上看FQDN，就是主机名的完整表达，类似绝对路径，通过一个FQDN我们可以在全网内锁定主机位置。 cache only DNS server : 有.的zone file的DNS服务器，本身没有任何解析数据，完全靠查询来获取数据源 forwarding DNS server : 连.的zone file都没有，完全靠向上层查询获取数据；当使用forwarding功能时，即使本身有.的zone file，也不会向.查询，该DNS server还是会将查询完全委托给上层。 CIDR:Classless Inter-Domain Routing, 无类域间路由，不按固定的字节来划分网络编号，可以使用IP地址中任何相邻位的数字作为网络编号，例如某机构需要2个B类网络大小的空间，那么可以使用前15位作为网络编号，例如127.127.0.0/15  A类,B类,C类网络：A类网络以IP地址的第一个字节(前8位)作为网络编号,剩下的24位为主机;B类网络前两个字节为网络编号;C类网络前三个字节为网络编号    DNS做什么 ipv4 32bit，ipv6 128bit，即使转成10/16进制也没人记得住，但是人类的头脑善于记录名字，所以可以搞一个名字跟IP对应，名字跟IP的对应关系解析，就是DNS提供的服务。
主机名的解析有一个发展的过程。
最初没有DNS人们如何记住各个服务名字跟IP的对应关系呢？就是写在/etc/hosts文件里，自己写麻烦，那就统一写到中心，使用的时候从中心拉取。
这个中心就是internic，主机名IP对应关系修改时，注册到internic中；用户准备上网之前先去internic把最新的文件拉下来，放在自己的/etc/hosts。
这种方式问题很多：
 例如internic拉取的文件会很大，每次打开电脑先拉个100G的文件然后再开始上网，就算你磁盘扛得住，你的网络不够好也很难受（因为你不能明确说明自己上网需要的主机名，只能拉全量，互联网业务增长该文件会越来越大） 例如这种方式是静态的，需要用户主动触发更新行为（你总不能让一个人开机默认就去下载100G的文件，他不可能给你授权的）；试想一下，一个网瘾少年下午6点睡眼惺忪的起床，打开电脑先从internic下载了半个小时文件，期间去洗漱吃了早饭，然后开开心心开始打游戏，突然，游戏掉线了，上贴吧一查，大家都说快去重新拉取internic的hosts文件呀，游戏域名被友商攻击换域名了，这还好，少年骂骂咧咧下载个文件就完事了，要是贴吧都上不去就更让人懵逼了  时代的进步总是聪明人推动的。Berkeley一个同学就觉得这种方式不太行，于是他就搞出一套BIND系统提供DNS服务。
BIND，Berkeley Internet Name Domain BIND管理方式 BIND是一套阶层式的管理主机名与IP对应关系的系统。
阶层式？可以简单理解为树状结构的不同层级，下面来简单分析下阶层式。
以www.baidu.com为例，最上层根服务器，domain name是&quot;.&quot;，然后有三个hostname &ldquo;net com cn&rdquo;，再到第三层，hostname分别是pdd baidu tencent，此时domain name为.com. ，以此类推。。。需要注意的是，不是每一个&quot;.&ldquo;都拆分domain name&amp;hostname，例如上图 video.www.baidu.com ，其中domain name为baidu.com.，hostname为video.www。按照上述方式分层，每一个服务节点（权威）只负责自己的一小撮域名，这就避免了大量数据集中的问题。
DNS阶层系统的最上方是一个&rdquo;.&quot;，root，是根服务器，本质上讲，这里的&quot;.&ldquo;后面其实是空标签，这是为root保留的；根服务器下一层管理的是Top Level Domains(TLD)，例如com. net. org.等等。"/>







<script src="/vendor/js/jquery.min.js" ></script>
<script src="/vendor/js/popper.min.js" ></script>
<script src="/vendor/js/bootstrap.min.js" ></script>
<script src="/vendor/js/smooth-scroll.polyfills.min.js" ></script>
<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<script src="/vendor/js/vue.min.js" ></script>


  






<link rel="stylesheet" href="https://tianqizhang93.github.io/scss/journal.min.5e8f3f653e9f6ce67bf72ff8ee6fee69decf7b5639a3ae7f8344750ad4e065b1.css" integrity="sha256-Xo8/ZT6fbOZ79y/47m/uad7Pe1Y5o65/g0R1CtTgZbE=" media="screen">



<link rel="stylesheet" href="https://tianqizhang93.github.io/scss/dark-mode.min.bdfa63b2e89903517dcbb1032b537d54cff3f425c19d008a78dfe49e6cd07ced.css" integrity="sha256-vfpjsuiZA1F9y7EDK1N9VM/z9CXBnQCKeN/knmzQfO0=" media="screen">


<script src="/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");
</script>




  
    <script src="/js/toc-collapse.js"></script>
  



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="/vendor/js/md5.min.js"></script>
<script>
  var gitalk = new Gitalk({
  clientID: 'your client id',
  clientSecret: 'your client secret',
  repo: 'repo name',
  owner: 'user',
  admin: ['user'],
  id: md5(location.pathname),
  distractionFreeMode: 'false'
  });
  window.onload = function () {
        gitalk.render('gitalk-container')
  }
</script>










</head>
<body>
    	<div id="app"><div ref="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://tianqizhang93.github.io/">
    
        <div class="nav-title">
            Home Page
        </div>
        
        <div class="nav-subtitle">
            ZTQ&#39;s Space.
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about">
                About
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	ztq.
	

    </div>
    
</div><div ref="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#dns%e6%8c%ba%e5%a5%bd%e5%95%a5%e6%98%afdns" onclick="onNavClick(`#dns挺好啥是dns-nav`)" id="dns挺好啥是dns-nav">
									DNS，挺好，啥是DNS？
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e4%b8%80%e4%ba%9b%e6%a6%82%e5%bf%b5" onclick="onNavClick(`#一些概念-nav`)" id="一些概念-nav">
									一些概念
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#dns%e5%81%9a%e4%bb%80%e4%b9%88" onclick="onNavClick(`#dns做什么-nav`)" id="dns做什么-nav">
									DNS做什么
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#bindberkeley-internet-name-domain" onclick="onNavClick(`#bindberkeley-internet-name-domain-nav`)" id="bindberkeley-internet-name-domain-nav">
									BIND，Berkeley Internet Name Domain
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#bind%e7%ae%a1%e7%90%86%e6%96%b9%e5%bc%8f" onclick="onNavClick(`#bind管理方式-nav`)" id="bind管理方式-nav">
									BIND管理方式
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#bind%e6%9f%a5%e8%af%a2%e6%b5%81%e7%a8%8b" onclick="onNavClick(`#bind查询流程-nav`)" id="bind查询流程-nav">
									BIND查询流程
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#bind%e9%83%a8%e7%bd%b2" onclick="onNavClick(`#bind部署-nav`)" id="bind部署-nav">
									BIND部署
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e6%ad%a3%e8%a7%a3rr" onclick="onNavClick(`#正解rr-nav`)" id="正解rr-nav">
									正解RR
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8f%8d%e8%a7%a3rr" onclick="onNavClick(`#反解rr-nav`)" id="反解rr-nav">
									反解RR
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#rndcremote-named-control" onclick="onNavClick(`#rndcremote-named-control-nav`)" id="rndcremote-named-control-nav">
									RNDC(remote named control)
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e8%bf%9c%e7%a8%8b%e6%9b%b4%e6%96%b0dns%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%95%b0%e6%8d%ae" onclick="onNavClick(`#远程更新dns服务器数据-nav`)" id="远程更新dns服务器数据-nav">
									远程更新DNS服务器数据
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#dns%e8%a7%a3%e6%9e%90%e5%99%a8" onclick="onNavClick(`#dns解析器-nav`)" id="dns解析器-nav">
									DNS解析器
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a class="pagination-action" v-on:click="toggleDarkMode">
            <i class="material-icons pagination-action-icon" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons pagination-action-icon" v-else="isDarkMode">
                brightness_7
            </i>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    About
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#dns%e6%8c%ba%e5%a5%bd%e5%95%a5%e6%98%afdns" onclick="onNavClick(`#dns挺好啥是dns-nav`)" id="dns挺好啥是dns-nav">
									DNS，挺好，啥是DNS？
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e4%b8%80%e4%ba%9b%e6%a6%82%e5%bf%b5" onclick="onNavClick(`#一些概念-nav`)" id="一些概念-nav">
									一些概念
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#dns%e5%81%9a%e4%bb%80%e4%b9%88" onclick="onNavClick(`#dns做什么-nav`)" id="dns做什么-nav">
									DNS做什么
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#bindberkeley-internet-name-domain" onclick="onNavClick(`#bindberkeley-internet-name-domain-nav`)" id="bindberkeley-internet-name-domain-nav">
									BIND，Berkeley Internet Name Domain
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#bind%e7%ae%a1%e7%90%86%e6%96%b9%e5%bc%8f" onclick="onNavClick(`#bind管理方式-nav`)" id="bind管理方式-nav">
									BIND管理方式
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#bind%e6%9f%a5%e8%af%a2%e6%b5%81%e7%a8%8b" onclick="onNavClick(`#bind查询流程-nav`)" id="bind查询流程-nav">
									BIND查询流程
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#bind%e9%83%a8%e7%bd%b2" onclick="onNavClick(`#bind部署-nav`)" id="bind部署-nav">
									BIND部署
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e6%ad%a3%e8%a7%a3rr" onclick="onNavClick(`#正解rr-nav`)" id="正解rr-nav">
									正解RR
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8f%8d%e8%a7%a3rr" onclick="onNavClick(`#反解rr-nav`)" id="反解rr-nav">
									反解RR
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#rndcremote-named-control" onclick="onNavClick(`#rndcremote-named-control-nav`)" id="rndcremote-named-control-nav">
									RNDC(remote named control)
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e8%bf%9c%e7%a8%8b%e6%9b%b4%e6%96%b0dns%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%95%b0%e6%8d%ae" onclick="onNavClick(`#远程更新dns服务器数据-nav`)" id="远程更新dns服务器数据-nav">
									远程更新DNS服务器数据
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#dns%e8%a7%a3%e6%9e%90%e5%99%a8" onclick="onNavClick(`#dns解析器-nav`)" id="dns解析器-nav">
									DNS解析器
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="https://tianqizhang93.github.io/">
            Home Page
        </a>
        
        <button type="button" class="nav-darkmode-toggle" v-on:click="toggleDarkMode">
            <i class="material-icons" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons" v-else="isDarkMode">
                brightness_7
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://tianqizhang93.github.io/">
        <div class="single-column-header-title">Home Page</div>
        
        <div class="single-column-header-subtitle">ZTQ&#39;s Space.</div>
        

    </a>
</div>

            <div id="content">
<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    DNS,挺好,啥是DNS?
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2021-05-13 20:53
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/cs">CS</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/dns">DNS</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="dns挺好啥是dns">DNS，挺好，啥是DNS？</h1>
<h2 id="一些概念">一些概念</h2>
<ul>
<li>FQDN: Fully Qualified Domain Name，全限定域名，同时带有主机名和域名的名称（通过符号“.”），例如一个FQDN是www.baidu.com，www是主机名，baidu.com是域名。再举例，我是海淀吴彦祖，你是**吴彦祖，但是我们还知道，有个人就叫吴彦祖，这么多吴彦祖我们都没有混淆，因为名字前面加上了地域，也就是域名。从逻辑上看FQDN，就是主机名的完整表达，类似绝对路径，通过一个FQDN我们可以在全网内锁定主机位置。</li>
<li>cache only DNS server : 有.的zone file的DNS服务器，本身没有任何解析数据，完全靠查询来获取数据源</li>
<li>forwarding DNS server : 连.的zone file都没有，完全靠向上层查询获取数据；当使用forwarding功能时，即使本身有.的zone file，也不会向.查询，该DNS server还是会将查询完全委托给上层。</li>
<li>CIDR:Classless Inter-Domain Routing, 无类域间路由，不按固定的字节来划分网络编号，可以使用IP地址中任何相邻位的数字作为网络编号，例如某机构需要2个B类网络大小的空间，那么可以使用前15位作为网络编号，例如127.127.0.0/15
<ul>
<li>A类,B类,C类网络：A类网络以IP地址的第一个字节(前8位)作为网络编号,剩下的24位为主机;B类网络前两个字节为网络编号;C类网络前三个字节为网络编号</li>
</ul>
</li>
</ul>
<h2 id="dns做什么">DNS做什么</h2>
<p>ipv4 32bit，ipv6 128bit，即使转成10/16进制也没人记得住，但是人类的头脑善于记录名字，所以可以搞一个名字跟IP对应，名字跟IP的对应关系解析，就是DNS提供的服务。</p>
<p>主机名的解析有一个发展的过程。</p>
<p>最初没有DNS人们如何记住各个服务名字跟IP的对应关系呢？就是写在/etc/hosts文件里，自己写麻烦，那就统一写到中心，使用的时候从中心拉取。</p>
<p>这个中心就是internic，主机名IP对应关系修改时，注册到internic中；用户准备上网之前先去internic把最新的文件拉下来，放在自己的/etc/hosts。</p>
<p>这种方式问题很多：</p>
<ul>
<li>例如internic拉取的文件会很大，每次打开电脑先拉个100G的文件然后再开始上网，就算你磁盘扛得住，你的网络不够好也很难受（因为你不能明确说明自己上网需要的主机名，只能拉全量，互联网业务增长该文件会越来越大）</li>
<li>例如这种方式是静态的，需要用户主动触发更新行为（你总不能让一个人开机默认就去下载100G的文件，他不可能给你授权的）；试想一下，一个网瘾少年下午6点睡眼惺忪的起床，打开电脑先从internic下载了半个小时文件，期间去洗漱吃了早饭，然后开开心心开始打游戏，突然，游戏掉线了，上贴吧一查，大家都说快去重新拉取internic的hosts文件呀，游戏域名被友商攻击换域名了，这还好，少年骂骂咧咧下载个文件就完事了，要是贴吧都上不去就更让人懵逼了</li>
</ul>
<p>时代的进步总是聪明人推动的。Berkeley一个同学就觉得这种方式不太行，于是他就搞出一套BIND系统提供DNS服务。</p>
<h2 id="bindberkeley-internet-name-domain">BIND，Berkeley Internet Name Domain</h2>
<h3 id="bind管理方式">BIND管理方式</h3>
<p>BIND是一套阶层式的管理主机名与IP对应关系的系统。</p>
<p>阶层式？可以简单理解为树状结构的不同层级，下面来简单分析下阶层式。</p>
<p><img src="/images/dns-bind/1.jpg" alt=""></p>
<p>以www.baidu.com为例，最上层根服务器，domain name是&quot;.&quot;，然后有三个hostname &ldquo;net com cn&rdquo;，再到第三层，hostname分别是pdd baidu tencent，此时domain name为.com. ，以此类推。。。需要注意的是，不是每一个&quot;.&ldquo;都拆分domain name&amp;hostname，例如上图  video.www.baidu.com ，其中domain name为baidu.com.，hostname为video.www。按照上述方式分层，每一个服务节点（权威）只负责自己的一小撮域名，这就避免了大量数据集中的问题。</p>
<p>DNS阶层系统的最上方是一个&rdquo;.&quot;，root，是根服务器，本质上讲，这里的&quot;.&ldquo;后面其实是空标签，这是为root保留的；根服务器下一层管理的是Top Level Domains(TLD)，例如com. net. org.等等。</p>
<p>每个上一层的DNS服务器，所记录的信息，只有下一层的主机名；再下一层，授权给再再下层某个主机管理，这就是分层管理；DNS分层最多到127层(实际上不会用到这么多)，每一层最多63个字符(不包括&rdquo;.&quot;)；同一层内不允许同名，确保唯一性。</p>
<h3 id="bind查询流程">BIND查询流程</h3>
<ol>
<li>当浏览器输入 <a href="https://www.baidu.com">https://www.baidu.com</a> ，先查浏览器缓存，再查/etc/hosts文件，都找不到www.baidu.com的解析时，会根据/etc/resolv.conf文件内配置的DNS服务器地址，去进行DNS解析，询问www.baidu.com的A记录</li>
<li>client第一步找到的DNS服务器通常为运营商提供的local DNS服务器，local DNS作为名称服务器，接收client端的递归查询请求，若local DNS服务器自身没有www.baidu.com的解析结果，则向.DNS服务器发起解析请求，询问www.baidu.com是啥A记录呢？
<ul>
<li>其实递归查询实际过程中，local DNS若未命中缓存，并不是直接查询根服务器，他会寻找已知最近的名称服务器(待实验确认)</li>
</ul>
</li>
<li>.并不知道www.baidu.com的IP，它会告诉你我只知道.com，IP给你，你去问它吧</li>
<li>然后local DNS获取到了.com的信息后，开始向.com询问www.baidu.com的解析结果</li>
<li>.com也不知道www.baidu.com的IP地址，它会说，我只认识baidu.com，你去问它吧
<ul>
<li>.com返回的一般是baidu.com的多个NS域名(及其IP,胶水记录)，如下例图，那么如何选择权威呢？BIND名称服务器使用RTT(roundtrip time)的度量方式来选择对同一区域中的名称服务器进行选择，即选择RTT最小的那个名称服务器(dig +trace抓包并没看到对RTT的探测，现象上看是从ns*.baidu.com里面随机选择的？)</li>
</ul>
</li>
</ol>
<p><img src="/images/dns-bind/2.jpg" alt=""></p>
<ol start="6">
<li>local DNS向baidu.com询问www.baidu.com的解析结果，baidu.com说，对了，这个归我管，我是权威，www.baidu.com的IP地址是****(这里其实应该是CNAME而不是A)</li>
<li>local DNS得到权威服务器baidu.com的响应后，会缓存www.baidu.com的解析结果并响应用户的DNS解析请求
<ul>
<li>名称服务器(local DNS)收到递归查询请求并迭代出结果后，会对结果进行缓存，甚至会包括“否定缓存”，即权威返回的结果是域名或数据类型不存在，也会进行缓存，同样的，TTL也适用于否定缓存；大部分情况下，名称服务器处理递归请求，即使所查询的实际内容(域名)不在缓存中，但是其对应的权威服务器地址应该是已经在缓存中的</li>
</ul>
</li>
</ol>
<p>PS：上述的解析查询一般是通过UDP协议，DNS端口53，但是不排除客户端有时会通过TCP来进行DNS解析，通常UDP解析失败客户端可能采用TCP重试，或者当客户端能预期到解析结果较大(个人理解单次解析网络请求包较多)时可能主动使用TCP进行解析。</p>
<p>关于NS记录，当上层记录的NS A记录与下层的不同时，以下层为准；例如baidu.com记录了NS记录test.baidu.com NS 1.1.1.1,当去1.1.1.1服务器时发现该服务器记录了test.baidu.com NS 2.2.2.2,那么将以2.2.2.2为准，即后续解析服务器缓存的是test.baidu.com NS 2.2.2.2。</p>
<p>DNS针对一个需要解析的领域(domain)称之为一个zone（区域）；记录主机名-&gt;IP称之为正解，记录IP-&gt;主机名称之为反解；正解zone主要记录的内容一般包括：SOA(Start Of Authority),NS(NameServer，DNS服务器),A(Address，地址，IP)；反解zone主要记录的内容除了SOA NS外，还包括PTR（PoinTeR，记录的是反解到的主机名）。&quot;.&ldquo;这个根服务器是所有DNS服务器都必须认识的，.的zone的类型称之为hint类型。</p>
<p>客户端主机内DNS相关的配置文件：</p>
<ul>
<li>/etc/hosts:hostname与IP的对应关系文档</li>
<li>/etc/resolv.conf:DNS服务器IP地址（通常是local DNS）；可以填写多个，一般使用第一个，当前面的服务器故障时，按顺序使用后面的服务器；使用DHCP时，系统会主动使用DHCP服务器返回的数据修正系统/etc/resolv.conf文件，可在 /etc/sysconfig/network-scripts/ifcfg-eth0内增加一行PEERDNS=no来关闭</li>
<li>/etc/nsswitch.conf:该文档决定先试用/etc/hosts还是/etc/resolv.conf</li>
</ul>
<p>DNS查询命令：</p>
<ul>
<li>host
<ul>
<li>host [FQDN] [server]</li>
<li>host -a [FQDN] [server]: host -a <a href="http://www.baidu.com">www.baidu.com</a> 114.114.114.114</li>
<li>host -l ***:需要授权，读取DNS服务器设置</li>
</ul>
</li>
<li>nslookup
<ul>
<li>nslookup [FQDN] [server]</li>
</ul>
</li>
<li>dig
<ul>
<li>dig [options] [FQDN] [@server]: dig AAAA <a href="http://www.baidu.com">www.baidu.com</a> @114.114.114.114
<ul>
<li>QUESTION: 要查询的内容</li>
<li>ANSWER:查询结果</li>
<li>AUTHORITY:由哪台DNS服务器提供的答案（权威服务器）</li>
</ul>
</li>
<li>dig -x [IP]: 查反解</li>
<li>+trace: dig *** +trace，可以实际抓包看下，+trace的过程其实是从root开始迭代</li>
</ul>
</li>
<li>whois：查询zone的管理者</li>
</ul>
<h3 id="bind部署">BIND部署</h3>
<p>BIND部署一般采用主从结构，master接受变更，slave同步master数据对外提供解析服务;master和slave都是权威;master又叫primary master，slave又叫secondary master, slave需要同步master的zone数据，该过程称为zone transfer；slave通常会配置为备份从master获取到的zone datafile数据，当slave冷启动时，会先加载本地zone datafile数据，并检查更新。</p>
<p>BIND核心数据有两部分：</p>
<ul>
<li>BIND本身的配置文件： /etc/named.conf ，规范主机的设定，zone file位置，权限设定</li>
<li>zone file: /var/named/ ,记录主机名于IP等关系</li>
<li>其他文件：
<ul>
<li>/etc/sysconfig/named ：是否启动chroot及额外的参数，当BIND被change root时，所有的文件都是在新root下，例如ROOTDIR=/var/named/chroot , 那么named.conf文件的位置实际为 /var/named/chroot/etc/named.conf</li>
<li>/var/run/named ：named进程pid文件</li>
</ul>
</li>
</ul>
<p>DNS通常起53端口的TCP&amp;UDP监听，同时还会监听本机953端口的TCP，作为rndc(remote name daemon control，远程名称解析服务控制)服务。</p>
<h4 id="正解rr">正解RR</h4>
<p>常见的正解文件RR(resource record)相关信息:</p>
<table>
<thead>
<tr>
<th>domain</th>
<th>ttl</th>
<th>class</th>
<th>RR type</th>
<th>RR data</th>
<th>serial</th>
</tr>
</thead>
<tbody>
<tr>
<td>主机名</td>
<td>60</td>
<td>IN</td>
<td>A</td>
<td>IPv4 addr</td>
<td>*</td>
</tr>
<tr>
<td>主机名</td>
<td>60</td>
<td>IN</td>
<td>AAAA</td>
<td>IPv6 addr</td>
<td>*</td>
</tr>
<tr>
<td>主机名</td>
<td>60</td>
<td>IN</td>
<td>NS</td>
<td>管理该域的主机名</td>
<td>*</td>
</tr>
<tr>
<td>7个参数</td>
<td>60</td>
<td>IN</td>
<td>SOA</td>
<td>管理该域的7个参数</td>
<td>*</td>
</tr>
<tr>
<td>主机名</td>
<td>60</td>
<td>IN</td>
<td>MX</td>
<td>邮件服务器</td>
<td>*</td>
</tr>
<tr>
<td>主机别名</td>
<td>60</td>
<td>IN</td>
<td>CNAME</td>
<td>该主机别名到其他主机</td>
<td>*</td>
</tr>
</tbody>
</table>
<p>PS:class取值（refer to <a href="https://www.ietf.org/rfc/rfc1035.txt">RFC1035</a> 3.2.4）：</p>
<ul>
<li>IN: the Internet</li>
<li>CS: the CSNET class (Obsolete - used only for examples in
some obsolete RFCs)</li>
<li>CH: the CHAOS class</li>
<li>HS: Hesiod [Dyer 87]</li>
</ul>
<p>PS，SOA的七个参数：</p>
<ol>
<li>MNAME: master服务器主机名
<ul>
<li>UPDATE requests should be forwarded toward the primary master</li>
<li>NOTIFY requests propagate outward from the primary master</li>
</ul>
</li>
<li>RNAME: 管理员email, email地址中@用.进行了提换, 例如test@gmail.com，实际记录值为test.gmail.com</li>
<li>SERIAL: YYYYMMDDNU格式，2021041500，代表2021年4月15日00次更新，slave会对比该serial以确认master数据是否比自身数据更新；该序列号&lt;=2<!-- raw HTML omitted -->32<!-- raw HTML omitted -->,即4294967296</li>
<li>REFRESH: 更新频率，slave向master请求更新的频率（仅适用于slave主动拉？不适用master notify?）；一般refresh&gt;retry*2</li>
<li>RETRY: slave与master通信的失败重试时间间隔</li>
<li>EXPIRE: 失效时间，slave一直retry直到expire后将不再继续重试获取相应的zone file;一般</li>
</ol>
<pre><code>refresh+retry &lt; expire, expire &gt;= retry*10, expire &gt;= 7days
</code></pre><ol start="7">
<li>TTL, a.k.a. MINIMUM: Time to live for purposes of negative caching. Recommendation for small and stable zones: 3600 seconds (1 hour). Originally this field had the meaning of a minimum TTL value for resource records in this zone; it was changed to its current meaning by RFC 2308. PLS refer to <a href="https://tools.ietf.org/html/rfc2308">RFC2308</a> (BIND8.2以前的版本，用SOA最后的TTL表示区域默认TTL；BIND8.2以后，RFC2308发布，该字段的含义变成了“否定缓存TTL, negative caching TTL”,指的是远程名称服务器将区域的否定响应缓存的时间，否定响应指所查询的特定域名或域名是数据类型不存在时的应答)
<ul>
<li>那么默认TTL如何设置呢？区域数据文件中最上面的$TTL就是在设置默认TTL（仅适用BIND8.2以后的版本）</li>
</ul>
</li>
</ol>
<p>PS：</p>
<ul>
<li>无论是name部分还是data部分，如果未使用FQDN(.结尾)，那么就会认为与本文件同域
<ul>
<li>name: zone file内第一个字段，名称的描述</li>
<li>data: zone file内第四个字段，值的描述</li>
</ul>
</li>
<li>@表示与当前文件描述域同名</li>
<li>若某个资源记录的名称使用了空格(space)或制表符(tab),那么他就会沿用上一条资源记录的名称</li>
</ul>
<p>e.g. zone[test.com] file如下:</p>
<pre><code>; Default TTL
$TTL 3h 

;
; Origin added to names not ending in a dot: test.com
;
@ IN SOA main main (
            1   ; serial
            3h  ; refresh after 3 hours
            1h  ; retry after 1 hour
            1w  ; expire after 1 week
            1h) ; negative caching TTL of 1 hour

;
; Name servers(The name '@' is implied)
;
  IN NS test1
  IN NS test2.testt.com.

;
; Address for the canonical names
;
localhost   IN  A   127.0.0.1
test        IN  A   10.10.1.1
            IN  A   10.10.1.2

;
; Alias
;
heihei  IN CNAME haha

</code></pre><p>MX的dig返回结果如下(以baidu.com为例)，可见返回了多条数据，前面带数字，一般选择数值较小的那一台</p>
<pre><code>***$ dig mx baidu.com

; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; mx baidu.com
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 34808
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 5, ADDITIONAL: 10

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;baidu.com.			IN	MX

;; ANSWER SECTION:
baidu.com.		7200	IN	MX	15 mx.n.shifen.com.
baidu.com.		7200	IN	MX	20 mx1.baidu.com.
baidu.com.		7200	IN	MX	20 jpmx.baidu.com.
baidu.com.		7200	IN	MX	20 mx50.baidu.com.
baidu.com.		7200	IN	MX	10 mx.maillb.baidu.com.
***

-----------------------------------------------------------
MX算法：
上述MX的dig结果中的数字代表该记录的优先级，该优先级是个无符号的16位数字（0-65535），数字越小优先级越高。MX转发为避免环路，转发处理时只会向更高的优先级服务器进行转发，转到最高还不行。。。会咋办忘了，具体可参考RFC2308：https://datatracker.ietf.org/doc/html/rfc2308

</code></pre><p>zone file内的特殊符号：</p>
<ul>
<li>@ : 代表该zone的意思，例如zone为baidu.com. ， 则 @ 代表baidu.com.</li>
<li>. : 加上了 . 表示这是个完整的主机名 (FQDN)，亦即是 &ldquo;hostname + domain name&rdquo; , 如果没有加上 . 的话，表示该名称仅为 &ldquo;hostname&rdquo; ,若zone file内主机名不以.结尾，则代表主机名.@ , 例如 baidu.com. zone 内 <a href="http://www.baidu.com">www.baidu.com</a>. <a href="http://www.baidu.com">www.baidu.com</a> 两条记录分别对应 <a href="http://www.baidu.com">www.baidu.com</a>. <a href="http://www.baidu.com.baidu.com">www.baidu.com.baidu.com</a>.</li>
</ul>
<h4 id="反解rr">反解RR</h4>
<p>常见的反解文件RR(resource record)相关信息，无A/AAAA，取而代之是PTR类型，其他同正解:</p>
<table>
<thead>
<tr>
<th>domain</th>
<th>ttl</th>
<th>class</th>
<th>RR type</th>
<th>RR data</th>
<th>serial</th>
</tr>
</thead>
<tbody>
<tr>
<td>***</td>
<td>60</td>
<td>IN</td>
<td>PTR</td>
<td>FQDN</td>
<td>*</td>
</tr>
</tbody>
</table>
<p>DNS分层搜索都是从大范围找到小范围最终定位，正解是根据域名寻找IP，根据域名从后向前搜索；那么反解是根据IP寻找域名，而IP越靠前代表网段范围越大，所以反解搜索时需要根据IP从前向后搜索，例如寻找11.12.13.14的主机名，一般是将IP倒序，再拼接.in-addr.arpa.(in-addr,inverse address; arpa is a TLD, refer to <a href="https://en.wikipedia.org/wiki/.arpa">wikipedia for arpa</a>)的后缀，如下：</p>
<pre><code>ipv4:

***$ dig -x 11.12.13.14

; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; -x 11.12.13.14
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NXDOMAIN, id: 61795
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;14.13.12.11.in-addr.arpa.	IN PTR
***

ipv6:

***$ dig -x 2408:871a:2100:2:0:ff:b09f:237

; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; -x 2408:871a:2100:2:0:ff:b09f:237
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NXDOMAIN, id: 49330
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;7.3.2.0.f.9.0.b.f.f.0.0.0.0.0.0.2.0.0.0.0.0.1.2.a.1.7.8.8.0.4.2.ip6.arpa. IN PTR
***
</code></pre><h4 id="rndcremote-named-control">RNDC(remote named control)</h4>
<p>BIND9以后，会在953启动rndc进程；使用rndc需要rndc key</p>
<p>rndc命令：</p>
<ul>
<li>rndc status: 查看DNS服务器状态</li>
<li>rndc stats: 记录DNS服务器当前统计数据，保存至/var/named/data/named_stats.txt</li>
<li>rndc dumpdb: 将cache数据写入文件，通常写到/var/named/data/cache_dump.db</li>
</ul>
<h3 id="远程更新dns服务器数据">远程更新DNS服务器数据</h3>
<p>nsupdate可远程更新DNS server数据。前提是，server端给出密钥，且指定zone支持修改。
客户端更新方式：</p>
<pre><code>***$ nsupdate -k somekey
&gt; server 1.1.1.1 // 指定server地址
&gt; update delete www.baidu.com // 删
&gt; update add www.baidu.com 600 A 1.1.1.1 // 增 
&gt; send
</code></pre><h3 id="dns解析器">DNS解析器</h3>
<p>DNS解析器配置，通常在/etc/resolv.conf，其包含以下指令的配置：</p>
<ul>
<li>
<p>domain</p>
<pre><code>domain test.com

# domain指令用来设定本地域名，domain空白字符后跟域名，域名最后没有. 
# 其他设定本地域名的方法：
#  1 本机hostname去除第一个.前面的数据，例如本机hostname为ztq.test.com,则根据hostname可推算本地域名为test.com
#  2 domain指令
#  3 环境变量LOCALDOMAIN
</code></pre></li>
<li>
<p>search</p>
<pre><code>search a.com b.com c.com
# search指令与domain指令互斥，用来指定搜索列表
</code></pre></li>
<li>
<p>nameserver</p>
<pre><code>nameserver 1.1.1.1
nameserver 2.2.2.2
# nameserver指令告诉解析器，要查询的名称服务器的地址
# nameserver最多支持3条，解析器会按顺序查询
# 小tips: 全零地址(0.0.0.0)和loopback地址(127.0.0.1)一般都用来指“本机”
</code></pre></li>
<li>
<p>sortlist</p>
<pre><code>sortlist 128.32.42.0/255.255.255.0 15.0.0.0
# 当解析器获取到多个结果时，会按顺序匹配sortlist中的地址，以此来获取多地址的使用优先级
# sortlist可以跟多地址
# 128.32.42.0/255.255.255.0，/后面是子网掩码
# 15.0.0.0，也可以使用这种不带子网掩码的，含义是15/32整个网段
</code></pre></li>
<li>
<p>options</p>
<pre><code>options debug
options ndots:2
options attempts:4
options timeout:2
options rotate
options ndots:2 attempts:4 timeout:2
# 解析器一些乱七八糟的配置
</code></pre></li>
</ul>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">Last modified on 2021-05-13</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://tianqizhang93.github.io/posts/cs/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/the-go-programming-language/">
			Next<br>The Go Programming Language
                </a>
                
                
                
                <a class="older-posts" href="https://tianqizhang93.github.io/posts/life/house/">
			Previous<br>新盘购房攻略(to be done)
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                


<div id="gitalk-container"></div>







        
            </div>
        </div>
    </div>
</div>

            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	ztq.
	
</div>
            </div>
    <script>
let app;

app = new Vue({
    el: '#app',
    data: {
        scrollY: 0,
        navOpacity: 0,
        isDrawerOpen: false,
        mounted: false,
        isDarkMode: false
    },
    methods: {
            sgn(t, x) {
                let k = 1. / (1. - 2 * t);
                if (x <= t) return 0;
                else if (x >= 1 - t) return 1;
                else {
                    return k * (x - t);
                }
            },
            handleScroll() {
                this.scrollY = window.scrollY;
                this.navOpacity = this.sgn(.0, Math.min(1, Math.max(0, window.scrollY / (this.pageHeadHeight() - this.navBarHeight() * 0.8))));
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;

                if (this.navOpacity >= 1) {
                    navBackground.style.opacity = 1;
                    navTitle.style.opacity = 1;
                } else {
                    navBackground.style.opacity = 0;
                    navTitle.style.opacity = 0;
                }
            },
            handleResize() {
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;
                extraContainer.style.left = (streamContainer.offsetWidth - extraContainer.offsetWidth) + 'px';
            },
            navBarHeight() {
                return this.$refs.navBar.offsetHeight;
            },
            pageHeadHeight() {
                return this.$refs.pageHead.offsetHeight;
            },
            toggleDrawer() {
                this.isDrawerOpen = !this.isDrawerOpen;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            closeDrawer() {
                this.isDrawerOpen = false;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            toggleDarkMode() {
                this.isDarkMode = !this.isDarkMode;
                if (this.isDarkMode==true){
                    document.cookie = "night=1;path=/";
                    document.body.classList.add("night");
                } else {
                    document.cookie = "night=0;path=/";
                    document.body.classList.remove("night");
                }
            }
    },
    created() {
        window.addEventListener('scroll', this.handleScroll);
        window.addEventListener('resize', this.handleResize);
        window._nonDesktop = function () {
            let check = false;
            (function (a) {
                if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true;
            })(navigator.userAgent || navigator.vendor || window.opera);
            return check;
        };
        
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1");
        if (night==""){
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                
            }
        }else{
            
            if (night=="1") {
                this.toggleDarkMode();
            }
        }
    },
    mounted() {
        this.handleScroll();
        this.handleResize();
        this.mounted = true;

        
        
    },
    destroyed() {
        window.removeEventListener('scroll', this.handleScroll);
        window.removeEventListener('resize', this.handleResize);
    }
});
</script>

<script src="/js/journal.js"></script>

    </body>
</html>
